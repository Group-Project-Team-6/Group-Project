//================================================================
//  theme_model_converter configuration
//================================================================

usage {
    puts "usage:"
    puts "        theme_model_converter <input files> [options]"
    puts "options:"
    puts "        -o <filename>   specify output filename"
    puts "        -s <scale>      scale size"
    puts "        -t <scale>      scale time"
    puts "        -C              combine meshes"
    puts "        -CT             combine meshes/textures"
    puts "        -S              output in text format"
    puts "        -V32            output vertices in 32bit types"
    puts "        -K32            output keyframes in 32bit types"
    puts "        -KD             append keyframes at discontinuity"
}

//----------------------------------------------------------------
//  default settings
//----------------------------------------------------------------

default {
    load "module/*"

    //  main control

    interact_mode = ctrl        // off on ctrl
    merge_mode = off            // off model motion
    prompt_mode = error         // off on warning error
    output_object = on          // off on
    output_script = off         // off on
    output_filename = ""
    object_extension = .mdx
    script_extension = .mds
    image_extension = .dds .png .jpg

    //  process control

    filter_script = "Filter"
    filter_script2 = ""

    size_scale = 1.0            // $scale
    time_scale = 1.0            // $scale
    frame_loop = default        // default off on $start,$end
    frame_rate = default        // default off on $fps
    frame_repeat = default      // default off on hold cycle

    embed_image = off           // off on
    rebuild_bbox = off          // off on model bone part mesh
    rebuild_bsphere = model     // off on model bone part mesh
    rebuild_wcenter = model     // off on model bone part mesh
    rebuild_triangle = on       // off on
    rebuild_keyframe = on       // off on
    unify_mesh = on             // off on
    unify_arrays = on           // off on
    unify_vertex = on           // off on
    unify_material = on         // off on
    unify_texture = on          // off on
    sort_type = on              // off on
    clear_block_name = 2        // off on $level

    freeze_texcoord = off       // off on
    freeze_color = off          // off on
    combine_texture = off       // off on
    combine_mesh = off          // off on
    remove_layer = off          // off on
    remove_unused = off         // off on

    limit_arrays_vertex = 65536 // $vertices
    limit_blend_weight = 4      // $weights
    limit_blend_matrix = 8      // $matrices
    epsilon_translate = 0.001   // $epsilon
    epsilon_rotate = 0.001      // $epsilon
    epsilon_scale = 0.001       // $epsilon
    epsilon_misc = 0.001        // $epsilon
    epsilon_static = -1.0       // $epsilon
    discon_max_frame = 0        // $max_frame
    discon_min_ratio = 10.0     // $min_ratio
    match_motion_target = on    // off on
    match_motion_basepose = on  // off on

    //  binary output control

    output_name = on            // off on
    output_anchor = auto        // off on auto
    output_bone = on            // off on only
    output_part = on            // off on only
    output_material = on        // off on only
    output_texture = on         // off on only
    output_motion = on          // off on only

    format_position = default   // default float half byte
    format_normal = default     // default float half byte
    format_color = default      // default float half ubyte
    format_texcoord = default   // default float half ubyte
    format_weight = default     // default float half ubyte
    format_keyframe = default   // default float half
    format_filename = tail      // full tail root lower upper

    //  fbx specific options

    fbx_filter_diffuse = on     // off on
    fbx_filter_specular = on    // off on
    fbx_filter_transp = on      // off on
    fbx_shiny_scale = 4.0       // $scale
    fbx_use_material_name = off // off on
    fbx_use_texture_name = off  // off on

    //  default data types

    format_position = half
    format_normal = byte
    format_color = ubyte
    format_texcoord = half
    format_weight = ubyte
    format_keyframe = half
}

//--------------------------------------------------------
//  format specific
//--------------------------------------------------------

input *.xml {
    load "plugin/ImportRAF"
}

input *.fbx {
    load "plugin/ImportFBX"
}

input *.dae {
    load "plugin/ImportFBX"
}

input *.abc {
    load "plugin/ImportFBX"
}

input *.mdx {
    unify_mesh = off
    unify_arrays = off
    unify_vertex = off
    unify_material = off
    unify_texture = off
}

input *.mds {
    unify_mesh = off
    unify_arrays = off
    unify_vertex = off
    unify_material = off
    unify_texture = off
}

//--------------------------------------------------------
//  parameter option
//--------------------------------------------------------

option -o %filename {
    output_filename = %filename
}

option -s %scale {
    size_scale = %scale
}

option -t %scale {
    time_scale = %scale
}

//--------------------------------------------------------
//  optimize option
//--------------------------------------------------------

option -C {
    freeze_texcoord = on
    freeze_color = on
    combine_mesh = on
    unify_mesh = on
    unify_arrays = on
    unify_vertex = on
    unify_material = on
    unify_texture = on
    remove_unused = on
}

option -CT {
    freeze_texcoord = on
    freeze_color = on
    combine_texture = on
    combine_mesh = on
    unify_mesh = on
    unify_arrays = on
    unify_vertex = on
    unify_material = on
    unify_texture = on
    remove_unused = on
}

//--------------------------------------------------------
//  output option
//--------------------------------------------------------

option -S {
    output_object = off
    output_script = on
}

option -V32 {
    format_position = float
    // format_normal = float
    // format_color = float
    // format_texcoord = float
    // format_weight = float
}

option -K32 {
    format_keyframe = float
}

option -KD {
    discon_max_frame = 2
    discon_min_ratio = 10.0
}

//--------------------------------------------------------
//  filter script
//--------------------------------------------------------

script Filter %target {
    CompFCurveChannel       %target on

    ScaleSize               %target $size_scale
    ScaleTime               %target $time_scale
    SetFrameLoop            %target $frame_loop
    SetFrameRate            %target $frame_rate
    SetFrameRepeat          %target $frame_repeat

    RebuildTriangle         %target $rebuild_triangle       //  needed before combine
    RemoveLayer             %target $remove_layer           //  needed before combine
    FreezeTexCoord          %target $freeze_texcoord
    FreezeColor             %target $freeze_color
    CombineTexture          %target $combine_texture
    CombineMesh             %target $combine_mesh
    RemoveUnused            %target $remove_unused          //  needed after combine
    UnifyArrays             %target $unify_arrays           //  needed after combine

    UnifyTexture            %target $unify_texture
    UnifyMaterial           %target $unify_material
    UnifyVertex             %target $unify_vertex
    UnifyMesh               %target $unify_mesh
    LimitVertexBlend        %target $limit_blend_weight $limit_blend_matrix
    UnifyArrays             %target $unify_arrays

    RebuildBoundingBox      %target $rebuild_bbox
    RebuildBoundingSphere   %target $rebuild_bsphere
    RebuildWeightedCenter   %target $rebuild_wcenter
    RebuildTriangle         %target $rebuild_triangle
    RebuildKeyFrame         %target $rebuild_keyframe

    LimitArraysVertex       %target $limit_arrays_vertex
    ClearBlockName          %target $clear_block_name
    EmbedImage              %target $embed_image
    SortByType              %target $sort_type
}
